{% extends "castle/page_with_sidebar.html" %}
{% load staticfiles %}
{% load castle_tags %}

{% block secondary_panel %}

  {#------------------------------------------------------------------#}
  {# User dashboard #}
  {#------------------------------------------------------------------#}
  {% if user_dashboard %}
    {% if profile %}
      {% if prompt_button %}
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Prompts</h3>
            </div> <!-- id="" class="panel-heading" -->
            <div class="panel-body">
              <a class="btn btn-success btn-block" href="/prompts/new/" id="new-prompt-link" type="button"><span class="glyphicon glyphicon-pencil"></span> &nbsp; Write a prompt</a>
            </div> <!-- id="" class="panel-body" -->
          </div> <!-- id="" class="panel panel-info" -->
      {% endif %}

          <div class="panel panel-warning">
            <div class="panel-heading">
              <h3 class="panel-title">User dashboard</h3>
            </div> <!-- id="" class="panel-heading" -->
            <div class="panel-body">
              <span class="glyphicon glyphicon-user"></span>
              <a href="/authors/u/profile/">Edit profile</a>
              <hr />
              <h4>Your desk</h4>
              <ul class="list-unstyled">
                <li><a href="/stories/new/">Write a new story</a></li>
                <li><a href="/authors/u/drafts/">Drafts</a> <span>{{profile|num_drafts}}</span></li>
              </ul>
              <h4>Your library</h4>
              <ul class="list-unstyled">
                <li><a href="/authors/{{profile.pen_name|url}}/">Published stories</a> <span>{{profile|num_stories}}</span></li>
              </ul>
              <hr />
              <h4>Friends: <span>{{profile|num_friends}}</span></h4>
              <div class="row">
                {% for f in profile.friends.all %}
                <div class="col-md-3">
                  {{f|user_icon}}
                </div> <!-- id="" class="col-md-3" -->
                {% endfor %}
              </div> <!-- id="" class="row" -->
              <hr />
              <h4>Followers: <span>{{profile|num_followers}}</span></h4>
              <div class="row">
                {% for f in profile.followers.all %}
                <div class="col-md-3">
                  {{f|user_icon}}
                </div> <!-- id="" class="col-md-3" -->
                {% endfor %}
              </div> <!-- id="" class="row" -->
            </div> <!-- id="" class="panel-body" -->
          </div> <!-- id="" class="panel panel-warning" -->
    {% endif %}
  {% endif %}

  {#------------------------------------------------------------------#}
  {# Panel for a different user #}
  {#------------------------------------------------------------------#}
  {% if other_user_sidepanel %}
    {% if author %}
          <div class="panel panel-warning">
            <div class="panel-heading">
              <h3 class="panel-title">{{author.pen_name}}</h3>
            </div> <!-- id="" class="panel-heading" -->
            <div class="panel-body">
              {% if is_friend %}
              <a class="btn btn-info btn-block" href="/friendship/del/{{author.id}}/" id="make-link" type="button">Un-follow {{author.pen_name}}</a>
              {% else %}
              <a class="btn btn-success btn-block" href="/friendship/add/{{author.id}}/" id="make-link" type="button">Follow {{author.pen_name}}</a>
              {% endif %}
              <hr />
              <h4>Friends <span>{{author|num_friends}}</span></h4>
              <div class="row">
                {% for f in author.friends.all %}
                <div class="col-md-3">
                  {{ f|user_icon }}
                </div> <!-- id="" class="col-md-3" -->
                {% endfor %}
              </div> <!-- id="" class="row" -->
              <hr />
              <h4>Followers <span>{{author|num_followers}}</span></h4>
              <div class="row">
                {% for f in author.followers.all %}
                <div class="col-md-3">
                  {{ f|user_icon }}
                </div> <!-- id="" class="col-md-3" -->
                {% endfor %}
              </div> <!-- id="" class="row" -->
            </div> <!-- id="" class="panel-body" -->
          </div> <!-- id="" class="panel panel-warning" -->
    {% endif %}
  {% endif %}
  
  {#------------------------------------------------------------------#}
  {# Story side-panel #}
  {#------------------------------------------------------------------#}
  {% if story_sidepanel %}
  
    {% if owner %}
          <a class="btn btn-info btn-block" href="/stories/edit/{{story.id}}/" id="edit-link" type="button"><span class="glyphicon glyphicon-pencil"></span> Edit story</a>
          <a class="btn btn-danger btn-block" href="/stories/delete/{{story.id}}/" id="delete-link" onclick="return confirm('Are you sure you want to delete this story? (there is no undelete function)');" type="button"><span class="glyphicon glyphicon-trash"></span> Delete story</a>
    {% endif %}
    {% if story.tag_set.count > 0 or story.prompt or story.prequel_to or story.sequel_to %}
          <div class="well well-sm" id="inspiration">
    {% if story.prompt %}
            <h4>Story prompt:</h4>
            {{story.prompt.body|encode_story}}
            <p><a href="/prompts/{{story.prompt.id}}/">{{story.prompt.title}}</a> by {{story.prompt.user|author_link}}</p>
    {% endif %}
    {% if story.prequel_to %}
            {% if story.prompt %}<hr>{% endif %}
            <h4>Inspired by (prequel to)</h4>
            {{story.prequel_to.body|small_snippet}}
            <small>
              <a href="/stories/{{story.prequel_to.id}}/">{{story.prequel_to.title}}</a>
              <br />
              {{story.prequel_to.user|author_span}}
            </small>
    {% endif %}
    {% if story.sequel_to %}
            {% if story.prompt or story.prequel_to %}<hr>{% endif %}
            <h4>Inspired by (sequel to)</h4>
            {{story.sequel_to.body|small_snippet}}
            <small>
              <a href="/stories/{{story.sequel_to.id}}/">{{story.sequel_to.title}}</a>
              <br />
              {{story.sequel_to.user|author_span}}
            </small>
    {% endif %}
    {% if story.tag_set.count > 0 %}
            {% if story.prompt or story.prequel_to or story.sequel_to %}<hr>{% endif %}
            <p>This story&#39;s tags are</p>
            <div class="tag-cloud" id="tags">
              {% for t in story.tag_set.all %}
              <a class="btn btn-primary btn-xs" href="/tags/{{t.tag|iriencode}}/" rel="tag" type="button">{{t.tag}}</a>
              {% endfor %}
            </div> <!-- id="tags" class="tag-cloud" -->
    {% endif %}
          </div> <!-- id="inspiration" class="well well-sm" -->
    {% endif %}
          <ul class="list-unstyled" id="story-stats">
    {% if story.draft %}
            <li id="mtime">Edited <abbr title="{{story.mtime|date:'Y-m-d'}}">{{story.mtime|age}}</abbr>. </p>
    {% else %}
            <li id="ptime">Published <abbr title="{{story.ptime|date:'Y-m-d'}}">{{story.ptime|age}}</abbr>. </p>
    {% endif %}
            <li id="num-ratings">Story viewed {{viewed}} times and rated {{rated}} times</li>
          </ul>
          <hr />
          <p class="small" id="licence">All stories on Ficlatt&eacute; are licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license">Creative Commons Attribution-Share Alike 3.0 License</a><a href="http://wiki.creativecommons.org/Sharing_Creative_Works">What does this mean?</a></p>
  {% endif %}
  {#------------------------------------------------------------------#}
  {# Prompt side panel #}
  {#------------------------------------------------------------------#}
  {% if prompt_sidepanel and prompt %}
          <a class="btn btn-success btn-block" href="/stories/new?prid={{prompt.id}}/" id="prompt-link" type="button"><span class="glyphicon glyphicon-pencil"></span> Take prompt</a>
          {% if owner %}
          <a class="btn btn-info btn-block" href="/prompts/edit/{{prompt.id}}/" id="prompt-link" type="button"><span class="glyphicon glyphicon-pencil"></span> Edit prompt</a>
          {% endif %}
          <ul class="list-unstyled" id="story-stats">
            <li id="pubdate"><small>Prompt published {{prompt.ctime|date:"jS F Y"}}</small></li>
          </ul>
          <hr />
          <p class="small" id="licence">All prompts on Ficlatt&eacute; are licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license">Creative Commons Attribution-Share Alike 3.0 License</a><a href="http://wiki.creativecommons.org/Sharing_Creative_Works">What does this mean?</a></p>
  {% endif %}
          
{% endblock secondary_panel %}